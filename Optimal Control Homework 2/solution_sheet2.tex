\documentclass[12pt,pdftex,a4paper]{scrartcl}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{listings}
\usepackage[onehalfspacing]{setspace}
\usepackage{xr}
\usepackage{float}
\usepackage{paralist}

\allowdisplaybreaks

% Figure as tikz
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat = newest}
\newlength\figureheight
\newlength\figurewidth

% Figure Lable
\usepackage{subfigure}
\usepackage[small, bf]{caption}

%\usepackage{cite}
\usepackage{csquotes}
\usepackage{trfsigns}

% FÃ¼r Einleitung
\usepackage{geometry}


% Own Commands
\newcommand{\ic}{\textit{i}}
\newcommand{\expo}{\mathrm{e}}
\newcommand{\dif}{\,\mathrm{d}}
\newcommand{\set}[1]{\mathbb{#1}}
\newcommand{\mcal}[1]{\mathcal{#1}}
\newcommand{\mat}[1]{\textbf{#1}}
\lstset{language=Python,basicstyle=\footnotesize}
\renewcommand{\arraystretch}{1.2}
\addtolength{\footskip}{15mm}
\DeclareMathOperator*{\argmin}{argmin}


\begin{document}
%\renewcommand{\labelenumi}{\textbf{\arabic{enumi}}}
%\renewcommand{\labelenumi}{\bfseries{\theenumi.}}
\renewcommand{\labelenumi}{\alph{enumi})}
%\renewcommand{\labelenumii}{(\arabic{enumii})}
%\renewcommand{\labelenumi}{(\theenumi)}
\newcommand{\scale}{2.36}

%\numberwithin{equation}%{section}
%\bibliographystyle{splncs03}
%\bibliographystyle{abbrv}
\renewcommand*{\figurename}{Fig.}
\renewcommand{\tablename}{Tab.}

\begin{titlepage}

\input{Titlepage.tex}

\end{titlepage}

%\tableofcontents
\setcounter{page}{1}
%\pagestyle{headings}
%\newpage


\newpage
\section*{Problem 2}
\begin{enumerate}
    \item To compute the equilibrium of the unforced system we consider the equation
    \begin{equation*}
         \begin{bmatrix}
             x^1 \\ x^2
         \end{bmatrix}
         = A
         \begin{bmatrix}
             x^1 \\ x^2
         \end{bmatrix}
    \end{equation*}
    with $A$ as defined on the exercise sheet. The matrix equation is equivalent to the following system of equations:
    \begin{align*}
         x^1 + 3 \cdot x^2 &= x^1 \\
         -0.5 \cdot x^1 +x^2 &= x^2.
    \end{align*}
    We receive immediately the unique solution $x^1 = x^2 = 0$, so the euibrilibrium of the unforced system lies in the origin. The stability of the equilibrium will be investigated by computing the eigenvalues of $A$:
    \begin{equation*}         
         \det (\lambda I - A) = \det \left(
         \begin{bmatrix}
            \lambda -1 & -3 \\
            0.5 & \lambda -1
         \end{bmatrix}
         \right) = (\lambda -1)^2 +1.5 = \lambda^2 -2 \lambda +2.5 \overset{!}{=} 0.
    \end{equation*}
    The solution of the eigenvalue equation is $\lambda_{1/2} = 1 \pm \im \frac{\sqrt{6}}{2}$, so the unforced system is not stable.
    
    \item The given discrete-time system can be formulated in the MPC scheme as follows:
    \begin{equation} 
    \begin{array}{rcl} 
    u_{MPC} (\cdot , x(t_j)) = &\argmin\limits_u& \sum\limits_{k=0}^2 x_j^T x_j + u_j^2 +x_3^T P x_3 \\ 
    &\mathrm{s.t.}& x_{j+1} = A x_j + B u_j \\ 
    && |u_j| \leq 1, x_j \in \mathbb{R}^2, x_3 \in \mathcal{X}_f
    \end{array}      
    \end{equation}
    with $P$, $A$, $B$ and $\mathcal{X}_f$ as defined on the exercise sheet.
    
    \item Now, we show that the MPC scheme in b) gives a stabilizing controller that is defined by $u_j = K x_j$.
   \begin{compactenum}[1.]
   \item The eigenvalue of $P$ is used as a lower limit in the following equation to show the feasibility of the controller:
      \begin{equation*}         
         \lambda_{min}(P) |x|^2 \leq x^T P x.
      \end{equation*}
   For all $x \in \mathcal{X}_f$ the relation
      \begin{equation*}         
         x^T P x \leq c = \frac{\lambda_{min}(P)}{|K|^2}
      \end{equation*}
   holds by definition. After deviding by $\lambda_{min}(P)$ we obtain the input constraint
      \begin{equation*}         
         |u|^2 = |K|^2 |x|^2 \leq 1.
      \end{equation*}
      That means that $|u| \leq 1$, so the controller is feasible.
   \item By inserting the given definitions we gain
      \begin{align*}         
         \phi(x_{j+1})-\phi(x_j) &= x_{j+1}^T P x_{j+1} - x_j^T P x_j \\
         &= ((A-BK)x_j)^T P (A-BK)x_j -  x_j^T P x_j \\
         &= x_j^T \underbrace{[(A-BK)^T P (A-BK)-P]}_{\substack{L}} x_j \\
         & \leq \lambda_{max}(L) |x|^2.
      \end{align*}
   The eigenvalues of $L$ were computed via \textsc{Matlab}. Both of them are smaller than -7. Besides, we use that 
      \begin{equation*}         
         f_0(x_j,u_j) = |x_j|^2 + |K|^2 |x_j|^2 = (1 + |K|^2) |x_j|^2 = 3.05 |x_j|^2.
      \end{equation*}
   It follows that
      \begin{align*}         
         \phi(x_{j+1})-\phi(x_j) &\leq \lambda_{max}(L) |x|^2 \\
         & < -7 |x|^2 \\
         & < -3.05 |x^2| \\
         &= -f_0(x_j,u_j)
      \end{align*}
   which was to be proven.
   \item For showing that the terminal region $\mathcal{X}_f$ is invariant, we need to demonstrate that $x_{k+1} \in \mathcal{X}_f$ if $x_{k} \in \mathcal{X}_f$. From the previous task we know that
   \begin{equation*}
       \phi(x_{j+1})-\phi(x_j) = x_{j+1}^T P x_{j+1} - x_j^T P x_j \leq -f_0(x_j,u_j).
   \end{equation*}
   It follows from the definition of the terminal region ($x_j^T P x_j \leq c$) that 
   \begin{equation*}
       x_{j+1}^T P x_{j+1} - c \leq -(|x_j|^2 + |u_j|^2).
   \end{equation*}
   This is equivalent to 
   \begin{equation*}
       x_{j+1}^T P x_{j+1} \leq c - \underbrace{(|x_j|^2 + |u_j|^2)}_{\substack{\geq 0}} \leq c.
   \end{equation*}
   Consequently, $x_{k+1} \in \mathcal{X}$ and the terminal region $\mathcal{X}_f$ is invariant.
   \end{compactenum}

   \item TODO
   \begin{align*}
		y &=
		\begin{bmatrix}
			x_1^\top & \cdots & x_N^\top & u_0 &  \cdots & u_{N-1} 
		\end{bmatrix}^\top
		\in \set{R}^{3N} \\
		H &= 2h
		\begin{bmatrix}
			\mat{I}_{2N} & 0 \\
			0 & \alpha\mat{I}_{N}\\
		\end{bmatrix}
		\in \set{R}^{3N \times 3N} \\
		A_{ineq} &= 0 \\
		b_{ineq} &= 0 \\		
		A_{eq} &= 
		\begin{bmatrix}
			\mat{I}_2 & 0 & \cdots & 0 & -B_D & 0 & \cdots & 0 \\
			-A_D & \mat{I}_2 & 0 & \cdots & 0 & -B_D & \ddots &\vdots\\
			& \ddots & \ddots & 0 & \cdots & 0 & \ddots & 0\\
			0 & & -A_D & \mat{I}_2 & 0 & \cdots & 0 & -B_D
		\end{bmatrix}
		\in \set{R}^{2N \times 3N} \\	
		b_{eq} &= 
		\begin{bmatrix}
			(A_D x_0)^\top & 0 & \cdots & 0
		\end{bmatrix}^\top
		\in \set{R}^{2N}
	\end{align*}
    
\end{enumerate}


	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.22]{pics/pic_g.jpg}
		\caption{Trajectories of the solutions for various $\alpha$}		
		\label{fig:pic_g}
	\end{figure}

	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.22]{pics/pic_h.jpg}
		\caption{Difference between the two solutions}		
		\label{fig:pic_h}
	\end{figure}

\end{document}
